<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do list</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="style1.css">
</head>
<body>

    <div class="wrapper">
        <div class="input">
            <input type="text" id="item" placeholder="Inserisci la cosa da fare"><br>
            <input type="date" name="data" id="data"><br>
        </div>
        <button id="btn">Inserisci</button>
        <div id="lista">
            <!--Cose da fare che con 2 pulsati (modifica, elimina)-->
        </div>
        <button class="mt50" id="btnStampa">Crea versione stampabile</button><br>
        <div id="feedback">
            <!-- Qui verrà mostrata la versione json della lista e inviata alla local storage-->
        </div>
        <button class="mt50" id="btnRecupera">Recupera vecchia versione</button>
        <div id="vecchiaVers">
            <!-- Solo ne caso in cui c'è qualcosa salvato nella local o session storage stampo gli item in formato json-->
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" integrity="sha512-3n19xznO0ubPpSwYCRRBgHh63DrV+bdZfHK52b1esvId4GsfwStQNPJFjeQos2h3JwCmZl0/LgLxSKMAI55hgw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        var item = document.getElementById("item");
        var date = document.getElementById("data");
        var list = document.getElementById("lista");
        var ul = document.createElement("ul");
        list.appendChild(ul);

        function lista(){
            var li = document.createElement('li')

            var toDoDate = date.value
            var toDoTxt = item.value

            var toDoTxtNode = document.createTextNode(toDoTxt)
            var toDoDateNode = document.createTextNode(toDoDate)

            var toDoTxtSpan = document.createElement('span')
            var toDoDateSpan = document.createElement('span')


            var modTxt = document.createTextNode('Modifica')
            var modifica = document.createElement('button')
            modifica.appendChild(modTxt)

            var elimTxt = document.createTextNode('Elimina')
            var elimina = document.createElement('button')
            elimina.appendChild(elimTxt)

            toDoTxtSpan.appendChild(toDoTxtNode)
            toDoDateSpan.appendChild(toDoDateNode)
            li.appendChild(toDoTxtSpan)
            li.appendChild(toDoDateSpan)
            li.appendChild(modifica)
            li.appendChild(elimina)
            li.setAttribute('class','animate__animated animate__lightSpeedInLeft')
            list.appendChild(li)

            document.getElementById("item").value = ""
            document.getElementById("data").value = null

            elimina.onclick = function(){
                li.setAttribute("class", "animate__animated animate__lightSpeedOutRight");
                setInterval(()=>
                {
                    li.parentNode.removeChild(li);
                },1500)
            }

            modifica.onclick = function() {
                document.getElementById("item").value = todo1;
                document.getElementById("data").value = todo2;
                li.parentNode.removeChild(li);
            }
            
        }

        function stampa() {
            var list = document.querySelectorAll("span");
            var feed = document.getElementById("feedback");
            feed.innerHTML = "";
            var json = [];
            for(var i = 0; i < list.length; i++) {
                json.push({item: list[i].innerText, data: list[++i].innerText});
            }
            for(var i = 0; i < json.length; i++) {
                feed.innerHTML += "Item: " + json[i].item + "<br>" + "Data: " + json[i].data + "<br><br>";
            }
            if(Modernizr.sessionstorage) {
                sessionStorage.setItem("Sessione", JSON.stringify(json));
            }
            document.getElementById("lista").innerHTML = "";
        }

        function recupera() {
            document.getElementById("vecchiaVers").innerHTML = "";
            if(Modernizr.sessionstorage) {
                var obj = JSON.parse(sessionStorage.getItem("Sessione"));
            }
            console.log(obj);
            for(var i = 0; i < obj.length; i++) {
                document.getElementById("vecchiaVers").innerHTML += "Item: " + obj[i].item + "<br>" + "Data: " + obj[i].data + "<br><br>";
            }
        }

        var btn = document.getElementById("btn");
        btn.addEventListener("click", lista, false);

        var btnStampa = document.getElementById("btnStampa");
        btnStampa.addEventListener("click", stampa, false);

        var btnRecupera = document.getElementById("btnRecupera");
        btnRecupera.addEventListener("click", recupera, false);

    </script>
    
</body>
</html>